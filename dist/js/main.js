(()=>{"use strict";const t=t=>{let e=t.querySelectorAll('a[href], area[href], input:not([disabled]), \n  select:not([disabled]), textarea:not([disabled]), button:not([disabled]), \n  iframe, object, embed, [tabindex="0"], [contenteditable]');e=Array.prototype.slice.call(e);const c=e[0],a=e[e.length-1];c.focus(),t.addEventListener("keydown",(t=>{9===t.keyCode&&(t.shiftKey?document.activeElement===c&&(t.preventDefault(),a.focus()):document.activeElement===a&&(t.preventDefault(),c.focus()))}),{once:!0})},e=()=>{const t=document.querySelector(".cart__sum"),e=document.querySelectorAll(".cart__item");let c=0;e.forEach((t=>{const e=t.querySelector(".cart__price"),a=parseInt(e.firstChild.textContent.split(" ").join(""));c+=a}));const a=(c+"").replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ");t.textContent=`Сумма заказа: ${a} ₽`};(()=>{const e=document.querySelector(".page-body"),c=e.querySelector(".header"),a=c.querySelector(".tabs"),s=c.querySelectorAll(".tabs-nav__item"),n=c.querySelector(".tabs-content"),o=c.querySelectorAll(".tabs-content__item"),r=c.clientHeight+a.clientHeight;let i;a.addEventListener("click",(a=>{if(a.target.closest(".tabs-nav__item")){const l=a.target.closest(".tabs-nav__item");s.forEach(((a,s)=>{a===l?(a.classList.toggle("tabs-nav__item--active"),o[s].classList.toggle("tabs-content__item--active"),a.classList.contains("tabs-nav__item--active")?(e.classList.add("page-body--lock"),n.classList.add("tabs-content--visible"),n.style.height=`calc(100vh - ${r}px)`,i=document.activeElement,t(c)):(e.classList.remove("page-body--lock"),n.classList.remove("tabs-content--visible"),n.style.height="0px",i.focus())):(a.classList.remove("tabs-nav__item--active"),o[s].classList.remove("tabs-content__item--active"))}))}}))})(),(()=>{const e=document.querySelector(".page-body"),c=document.querySelectorAll(".request-call"),a=e.querySelector(".popup-call"),s=a.querySelector(".popup-dialog");let n;const o=t=>{t.target.closest(".contacts__button")&&e.classList.remove("page-body--lock"),a.classList.remove("popup--visible"),s.classList.remove("popup-dialog--visible"),n.focus()},r=c=>{e.classList.add("page-body--lock"),a.classList.add("popup--visible"),s.classList.add("popup-dialog--visible"),n=document.activeElement,t(a),a.addEventListener("click",(t=>{(t.target.closest(".popup__close")||t.target.classList.contains("popup"))&&o(c)})),a.addEventListener("keydown",(t=>{27!==t.keyCode&&"Escape"!==t.key&&"Esc"!==t.key||o(c)}))};c.forEach((t=>t.addEventListener("click",r)))})(),(()=>{const t=document.querySelectorAll("input[name=phone]"),e=t=>{const e="+7 (___) ___-__-__",c=e.replace(/\D/g,"");let a=t.target.value.replace(/\D/g,""),s=0;c.length>=a.length&&(a=c),t.target.value=e.replace(/./g,(t=>/[_\d]/.test(t)&&s<a.length?a.charAt(s++):s>=a.length?"":t)),((t,e)=>{if(e.focus(),e.setSelectionRange)e.setSelectionRange(t,t);else if(e.createTextRange){const c=e.createTextRange();c.collapse(!0),c.moveEnd("character",t),c.moveStart("character",t),c.select()}})(t.target.value.length,t.target)};t.forEach((t=>{t.addEventListener("focus",(()=>{t.value="+7 "})),t.addEventListener("input",e,!1)}))})(),(()=>{const t=document.querySelector(".popup-call"),e=t.querySelector(".popup__form"),c=t.querySelector(".form__checkbox-input"),a=t.querySelector(".form__button");try{e.addEventListener("submit",(t=>{t.preventDefault(),(t=>{const e=t.querySelectorAll("input"),c=new FormData(t),a={};c.forEach(((t,e)=>{a[e]=t})),(t=>{let e=!0;return t.forEach((t=>{"phone"===t.getAttribute("name")&&(t.value.match(/\+7\s?[(]{0,1}[0-9]{3}[)]{0,1}\s?\d{3}[-]{0,1}\d{2}[-]{0,1}\d{2}/)||(e=!1)),"name"===t.getAttribute("name")&&(t.value.match(/^[а-яёa-z]+$/gi)||(e=!1)),"checkbox"===t.getAttribute("name")&&(t.checked||(e=!1)),e?t.classList.remove("form__input--error"):t.classList.add("form__input--error")})),e})(e)&&(async t=>{try{const e=await fetch("https://jsonplaceholder.typicode.com/posts",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});return await e.json()}catch(t){console.log(t.message)}})(a).then((t=>{console.log(t),e.forEach((t=>{t.value="",t.classList.remove("form__input--error")}))})).catch((t=>{console.log(t.message)}))})(e)}))}catch(t){console.log(t.message)}c.addEventListener("click",(()=>{c.checked?a.removeAttribute("disabled"):a.setAttribute("disabled",!0)}))})(),(()=>{const t=document.querySelector(".page-body"),e=t.querySelector(".header"),c=t.querySelector(".categories"),a=c.querySelectorAll(".categories-nav__item"),s=c.querySelectorAll(".categories-content__item"),n=c=>{c.target.closest(".header--active")&&(c.target.closest(".categories")||(t.classList.remove("page-body--lock"),e.classList.remove("header--active"),a.forEach(((t,e)=>{t.classList.remove("categories-nav__item--active"),s[e].classList.remove("categories-content__item--active")}))))};c.addEventListener("click",(c=>{if(c.target.closest(".categories-nav__item")){const o=c.target.closest(".categories-nav__item");a.forEach(((c,a)=>{c===o?(c.classList.toggle("categories-nav__item--active"),s[a].classList.toggle("categories-content__item--active"),c.classList.contains("categories-nav__item--active")?(t.classList.add("page-body--lock"),e.classList.add("header--active"),window.addEventListener("click",n,!0)):(t.classList.remove("page-body--lock"),e.classList.remove("header--active"))):(c.classList.remove("categories-nav__item--active"),s[a].classList.remove("categories-content__item--active"))}))}}))})(),(()=>{const t=document.querySelector(".cards__list");(async t=>{const e=await fetch("db/cards.json");return await e.json()})().then((e=>{e.forEach((e=>{t.append((t=>{const e=document.createElement("li");return e.classList.add("cards__item","card"),e.setAttribute("data-id",t.code),e.insertAdjacentHTML("beforeend",`\n            <div class="card__header">\n                <p class="card__hit">Хит продаж</p>\n                <div>\n                    <button class="button"><img src="./images/compare.svg" alt=""></button>\n                    <button class="button"><img src="./images/heart.svg" alt=""></button>\n                </div>\n            </div>\n            <img class="card__img" src="images/${t.photo}.jpg" alt="Фото двери ${t.title}">\n            <div class="card__body">\n                <p class="card__stock text text--medium">${t.stock?"В наличии":"Нет в наличии"}\n                    <span class="card__code">Арт.: ${t.code}</span>\n                </p>\n                <h3 class="card__title title title--medium">${t.name}</h3>\n                <p class="card__subtitle">${t.type}</p>\n                <div class="card__button-wrapper">\n                    <button class="button card__button-add">\n                        <svg class="card__icon" width="24" height="24">\n                            <use xlink:href="images/sprite.svg#card"></use>\n                        </svg>\n                    </button>\n                    <p class="card__prices">\n                        <span class="card__discount title title--medium">${t.discount}<span> ₽</span></span>\n                        <span class="card__price">${t.price}<span> ₽</span></span>\n                    </p>\n                </div>\n                <a class="card__link text text--medium" href="#!">Купить в один клик</a>\n            </div>\n        `),e})(e))}))})).catch((t=>console.log(t)))})(),(()=>{const t=document.querySelector(".cards__list"),c=document.querySelector("#cart-counter");t.addEventListener("click",(t=>{if(t.target.closest(".card__button-add")){const s=t.target.closest(".card"),n=s.getAttribute("data-id"),o=document.querySelectorAll(".cart__item");let r=!1;c.textContent=+c.textContent+1,o.forEach((t=>{r=n===t.getAttribute("data-id")})),r?o.forEach((t=>{if(t.getAttribute("data-id")===n){const e=t.querySelector(".cart__amount"),c=t.querySelector(".cart__price"),a=(parseInt(c.getAttribute("data-price").split(" ").join(""))+parseInt(c.firstChild.textContent.split(" ").join(""))+"").replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ");e.textContent=+e.textContent+1,c.textContent=`${a} ₽`}})):(a={photo:s.querySelector(".card__img").src,title:s.querySelector(".card__title").textContent,subtitle:s.querySelector(".card__subtitle").textContent,price:s.querySelector(".card__discount").firstChild.textContent,id:s.getAttribute("data-id")},document.querySelector(".cart__list").append((t=>{const e=t.photo.replace(".jpg","_small.jpg"),c=document.createElement("li");return c.classList.add("cart__item"),c.setAttribute("data-id",t.id),c.insertAdjacentHTML("beforeend",`\n                <img class="cart__image" src="${e}" width="56" height="60" alt="Фото двери ${t.title}">\n                <div class="cart__body">\n                    <h3 class="cart__title text text--medium">${t.title}</h3>\n                    <p class="cart__subtitle caption caption--medium">${t.subtitle}</p>\n                </div>\n                <div class="cart__inner">\n                    <p class="cart__price text text--medium" data-price="${t.price}">${t.price} ₽</p>\n                    <div class="cart__counter">\n                        <button class="button cart__change cart__change--decrease">-</button>\n                        <p class="cart__amount">1</p>\n                        <button class="button cart__change cart__change--increase">+</button>\n                    </div>\n                </div>\n        `),c})(a))),e()}var a}))})(),(()=>{const t=document.querySelector(".cart__list"),c=document.querySelector("#cart-counter");t.addEventListener("click",(t=>{if(t.target.closest(".cart__change")){const a=t.target.closest(".cart__item"),s=a.querySelector(".cart__amount"),n=a.querySelector(".cart__price"),o=parseInt(n.getAttribute("data-price").split(" ").join("")),r=parseInt(n.firstChild.textContent.split(" ").join(""));if(t.target.closest(".cart__change--decrease")){const t=(r-o+"").replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ");s.textContent<=1?a.remove():(s.textContent=+s.textContent-1,n.textContent=`${t} ₽`),c.textContent=+c.textContent-1}if(t.target.closest(".cart__change--increase")){const t=(o+r+"").replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ");s.textContent=+s.textContent+1,n.textContent=`${t} ₽`,c.textContent=+c.textContent+1}e()}}))})()})();